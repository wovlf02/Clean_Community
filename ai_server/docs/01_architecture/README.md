# 📐 시스템 아키텍처

> AI 혐오 표현 탐지 API 서버의 전체 시스템 구조

## 📋 개요

본 서버는 **3-모델 앙상블 기반**의 혐오 표현 탐지 시스템으로, FastAPI를 통해 RESTful API를 제공합니다.

---

## 🏗️ 전체 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                         Client                                   │
│                    (Web/Mobile/API)                              │
└─────────────────────────┬───────────────────────────────────────┘
                          │ HTTP Request
                          ▼
┌─────────────────────────────────────────────────────────────────┐
│                     FastAPI Server                               │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    API Layer (Routes)                        │ │
│  │   /analyze    /batch    /health                             │ │
│  └──────────────────────────┬──────────────────────────────────┘ │
│                              │                                    │
│  ┌──────────────────────────▼──────────────────────────────────┐ │
│  │                    Service Layer                             │ │
│  │              EnsembleClassifier                              │ │
│  └──────────────────────────┬──────────────────────────────────┘ │
│                              │                                    │
│  ┌──────────────────────────▼──────────────────────────────────┐ │
│  │                    Model Layer                               │ │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            │ │
│  │  │  KcELECTRA  │ │  Soongsil   │ │   RoBERTa   │            │ │
│  │  │   (0.35)    │ │   (0.33)    │ │   (0.32)    │            │ │
│  │  └─────────────┘ └─────────────┘ └─────────────┘            │ │
│  └──────────────────────────┬──────────────────────────────────┘ │
│                              │                                    │
│  ┌──────────────────────────▼──────────────────────────────────┐ │
│  │                    Utils Layer                               │ │
│  │         Thresholds    Labels    Config                       │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🔄 요청 처리 흐름

```
1. 클라이언트 요청
      │
      ▼
2. FastAPI 라우터 (app/api/routes/)
      │
      ▼
3. 요청 검증 (Pydantic Schema)
      │
      ▼
4. 앙상블 분류기 호출
      │
      ├──► KcELECTRA 예측 (가중치: 0.35)
      ├──► SoongsilBERT 예측 (가중치: 0.33)
      └──► RoBERTa 예측 (가중치: 0.32)
      │
      ▼
5. 가중 평균 계산
      │
      ▼
6. 클래스별 임계값 적용
      │
      ▼
7. 응답 생성 및 반환
```

---

## 🧩 핵심 컴포넌트

### 1. API Layer (라우팅)

| 파일 | 역할 |
|------|------|
| `app/api/routes/analyze.py` | 분석 API 엔드포인트 |
| `app/api/__init__.py` | 라우터 통합 |

### 2. Service Layer (비즈니스 로직)

| 파일 | 역할 |
|------|------|
| `app/services/model_loader.py` | 모델 로드 및 관리 |

### 3. Model Layer (AI 모델)

| 파일 | 역할 |
|------|------|
| `app/models/classifier.py` | 단일 모델 분류기 |
| `app/models/ensemble.py` | 앙상블 분류기 |

### 4. Schema Layer (데이터 검증)

| 파일 | 역할 |
|------|------|
| `app/schemas/request.py` | 요청 스키마 |
| `app/schemas/response.py` | 응답 스키마 |

### 5. Utils Layer (유틸리티)

| 파일 | 역할 |
|------|------|
| `app/utils/constants.py` | 라벨, 임계값 정의 |

---

## 📁 관련 문서

- [디렉토리 구조](./directory-structure.md)
- [모듈별 상세 설명](./modules.md)
