# 01. FastAPI í”„ë¡œì íŠ¸ êµ¬ì¡°

**ê´€ë ¨ ë¬¸ì„œ**: [ê°œë°œ í™˜ê²½ ì„¤ì •](../../06_development/setup.md) | [ì‹œìŠ¤í…œ ì„¤ê³„](../../03_architecture/system-design.md)

---

## ğŸ“‹ ê°œìš”

ì´ ë¬¸ì„œëŠ” ê°ì •ë¶„ì„ AI ëª¨ë¸ ì„œë²„ì˜ FastAPI í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ ìƒì„±
- [ ] ê¸°ë³¸ íŒŒì¼ êµ¬ì¡° ì„¤ì •
- [ ] `__init__.py` íŒŒì¼ ìƒì„±
- [ ] `.gitignore` ì„¤ì •
- [ ] í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ êµ¬ì¡°í™”

---

## ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
apps/ai-server/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                 # FastAPI ì•± ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”‚   â”œâ”€â”€ config.py               # ì„¤ì • ë° í™˜ê²½ ë³€ìˆ˜
â”‚   â”‚
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ analyze.py      # ê°ì •ë¶„ì„ API ë¼ìš°íŠ¸
â”‚   â”‚   â”‚   â””â”€â”€ health.py       # í—¬ìŠ¤ì²´í¬ ë¼ìš°íŠ¸
â”‚   â”‚   â””â”€â”€ deps.py             # ì˜ì¡´ì„± ì£¼ì…
â”‚   â”‚
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ classifier.py       # MultiLabelClassifier ì •ì˜
â”‚   â”‚   â””â”€â”€ ensemble.py         # ì•™ìƒë¸” ëª¨ë¸ ë˜í¼
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ request.py          # ìš”ì²­ ìŠ¤í‚¤ë§ˆ (Pydantic)
â”‚   â”‚   â””â”€â”€ response.py         # ì‘ë‹µ ìŠ¤í‚¤ë§ˆ (Pydantic)
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ analyzer.py         # ê°ì •ë¶„ì„ ì„œë¹„ìŠ¤ ë¡œì§
â”‚   â”‚   â””â”€â”€ model_loader.py     # ëª¨ë¸ ë¡œë”© ì„œë¹„ìŠ¤
â”‚   â”‚
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ text_processor.py   # í…ìŠ¤íŠ¸ ì „ì²˜ë¦¬
â”‚       â””â”€â”€ constants.py        # ìƒìˆ˜ ì •ì˜ (ë¼ë²¨ëª… ë“±)
â”‚
â”œâ”€â”€ models/                     # PT ëª¨ë¸ íŒŒì¼ (gitignore)
â”‚   â”œâ”€â”€ kcelectra.pt
â”‚   â”œâ”€â”€ soongsil.pt
â”‚   â””â”€â”€ roberta_base.pt
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py             # pytest ì„¤ì •
â”‚   â”œâ”€â”€ test_analyze.py         # API í…ŒìŠ¤íŠ¸
â”‚   â””â”€â”€ test_model.py           # ëª¨ë¸ ìœ ë‹› í…ŒìŠ¤íŠ¸
â”‚
â”œâ”€â”€ .env.example                # í™˜ê²½ ë³€ìˆ˜ ì˜ˆì‹œ
â”œâ”€â”€ .gitignore
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ requirements-dev.txt        # ê°œë°œ ì˜ì¡´ì„±
â””â”€â”€ README.md
```

---

## ğŸ“„ ì£¼ìš” íŒŒì¼ ì„¤ëª…

### app/main.py

FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë©”ì¸ ì—”íŠ¸ë¦¬í¬ì¸íŠ¸ì…ë‹ˆë‹¤.

```python
from fastapi import FastAPI
from contextlib import asynccontextmanager
from app.api.routes import analyze, health
from app.services.model_loader import load_models

@asynccontextmanager
async def lifespan(app: FastAPI):
    # ì‹œì‘ ì‹œ ëª¨ë¸ ë¡œë“œ
    load_models()
    yield
    # ì¢…ë£Œ ì‹œ ì •ë¦¬

app = FastAPI(
    title="Emotion Analysis API",
    description="í•œêµ­ì–´ í˜ì˜¤ í‘œí˜„ íƒì§€ AI API",
    version="1.0.0",
    lifespan=lifespan
)

app.include_router(analyze.router, prefix="/analyze", tags=["ë¶„ì„"])
app.include_router(health.router, tags=["í—¬ìŠ¤ì²´í¬"])
```

### app/config.py

í™˜ê²½ ë³€ìˆ˜ ë° ì„¤ì •ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.

```python
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    # ì„œë²„ ì„¤ì •
    HOST: str = "0.0.0.0"
    PORT: int = 8000
    DEBUG: bool = False
    
    # ëª¨ë¸ ì„¤ì •
    MODEL_PATH: str = "./models"
    KCELECTRA_MODEL: str = "beomi/KcELECTRA-base"
    SOONGSIL_MODEL: str = "soongsil-ai/soongsil-bert-base"
    ROBERTA_MODEL: str = "klue/roberta-base"
    
    # ì•™ìƒë¸” ê°€ì¤‘ì¹˜
    KCELECTRA_WEIGHT: float = 0.35
    SOONGSIL_WEIGHT: float = 0.33
    ROBERTA_WEIGHT: float = 0.32
    
    # ì¶”ë¡  ì„¤ì •
    MAX_LENGTH: int = 128
    BATCH_SIZE: int = 32
    
    class Config:
        env_file = ".env"

settings = Settings()
```

### app/utils/constants.py

ìƒìˆ˜ ë° ë¼ë²¨ ì •ì˜ì…ë‹ˆë‹¤.

```python
# 9ê°œ í˜ì˜¤ ì¹´í…Œê³ ë¦¬ ë¼ë²¨
LABELS = [
    "ì—¬ì„±/ê°€ì¡±",
    "ë‚¨ì„±", 
    "ì„±ì†Œìˆ˜ì",
    "ì¸ì¢…/êµ­ì ",
    "ì—°ë ¹",
    "ì§€ì—­",
    "ì¢…êµ",
    "ê¸°íƒ€ í˜ì˜¤",
    "ì•…í”Œ/ìš•ì„¤"
]

# í´ë˜ìŠ¤ë³„ ìµœì í™”ëœ ì„ê³„ê°’
THRESHOLDS = {
    "ì—¬ì„±/ê°€ì¡±": 0.50,
    "ë‚¨ì„±": 0.50,
    "ì„±ì†Œìˆ˜ì": 0.53,
    "ì¸ì¢…/êµ­ì ": 0.29,
    "ì—°ë ¹": 0.50,
    "ì§€ì—­": 0.50,
    "ì¢…êµ": 0.39,
    "ê¸°íƒ€ í˜ì˜¤": 0.50,
    "ì•…í”Œ/ìš•ì„¤": 0.45
}

# ëª¨ë¸ ê°€ì¤‘ì¹˜
MODEL_WEIGHTS = {
    "kcelectra": 0.35,
    "soongsil": 0.33,
    "roberta": 0.32
}
```

---

## ğŸ”— ì°¸ê³  ë¬¸ì„œ

| ë¬¸ì„œ | ê²½ë¡œ | ì„¤ëª… |
|------|------|------|
| ê°œë°œ í™˜ê²½ ì„¤ì • | `docs/06_development/setup.md` | ì „ì²´ í”„ë¡œì íŠ¸ êµ¬ì¡° |
| ëª¨ë¸ ì•„í‚¤í…ì²˜ | `ai-model/docs/03_ëª¨ë¸_ì•„í‚¤í…ì²˜.md` | ëª¨ë¸ êµ¬ì¡° ë° ì¶”ë¡  ë¡œì§ |
| í”„ë¡œì íŠ¸ ê°œìš” | `ai-model/docs/01_í”„ë¡œì íŠ¸_ê°œìš”.md` | í”„ë¡œì íŠ¸ êµ¬ì¡° ì°¸ê³  |

---

**ë‹¤ìŒ ë¬¸ì„œ**: [02_í™˜ê²½_ì„¤ì •.md](./02_í™˜ê²½_ì„¤ì •.md)
