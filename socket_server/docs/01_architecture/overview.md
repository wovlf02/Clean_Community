# 시스템 개요

**관련 문서**: [디렉토리 구조](./directory-structure.md) | [데이터 흐름](./data-flow.md)

---

## 1. 아키텍처 개요

Socket Server는 실시간 양방향 통신을 담당하는 독립적인 마이크로서비스입니다.

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              Clients                                     │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐                    │
│  │ 브라우저 │  │ 브라우저 │  │ 브라우저 │  │ 브라우저 │                    │
│  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘                    │
└───────┼────────────┼────────────┼────────────┼──────────────────────────┘
        │            │            │            │
        └────────────┴─────┬──────┴────────────┘
                           │ WSS (WebSocket Secure)
                           ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         Socket Server                                    │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │                      Express.js + Socket.IO                         │ │
│  │                                                                     │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │ │
│  │  │    Chat     │  │  Presence   │  │Notification │                │ │
│  │  │   Handler   │  │   Handler   │  │   Handler   │                │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                │ │
│  │                                                                     │ │
│  │  ┌─────────────┐  ┌─────────────┐                                 │ │
│  │  │    Auth     │  │   Logger    │                                 │ │
│  │  │ Middleware  │  │   Service   │                                 │ │
│  │  └─────────────┘  └─────────────┘                                 │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                    │                                     │
│                                    ▼                                     │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │                       Redis Adapter                                 │ │
│  │                   (Pub/Sub for Scaling)                             │ │
│  └────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                              Redis                                       │
│                         (ElastiCache)                                    │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 2. 핵심 컴포넌트

### 2.1 Express.js HTTP Server

| 역할 | 설명 |
|------|------|
| 헬스체크 | `/health`, `/ready` 엔드포인트 제공 |
| CORS | Cross-Origin 요청 처리 |
| 보안 | Helmet을 통한 HTTP 보안 헤더 |

### 2.2 Socket.IO Server

| 역할 | 설명 |
|------|------|
| WebSocket 관리 | 클라이언트 연결/해제 처리 |
| 이벤트 라우팅 | 이벤트를 적절한 핸들러로 전달 |
| Room 관리 | 채팅방 기반 메시지 브로드캐스트 |

### 2.3 Redis Adapter

| 역할 | 설명 |
|------|------|
| Pub/Sub | 다중 인스턴스 간 이벤트 동기화 |
| 수평 확장 | 로드밸런서 뒤 여러 인스턴스 지원 |

---

## 3. 네임스페이스 구조

현재 기본 네임스페이스(`/`)에서 모든 이벤트를 처리합니다.

| 네임스페이스 | 용도 |
|--------------|------|
| `/` (기본) | 채팅, 알림, 프레즌스 통합 처리 |

---

## 4. 인증 흐름

```
┌─────────┐     ┌─────────────┐     ┌─────────────┐
│ Client  │────▶│   Socket    │────▶│    Auth     │
│         │     │   Connect   │     │ Middleware  │
└─────────┘     └─────────────┘     └──────┬──────┘
                                           │
                      ┌────────────────────┼────────────────────┐
                      │                    │                    │
                      ▼                    ▼                    ▼
               [JWT 검증 성공]       [JWT 없음]           [JWT 만료]
                      │                    │                    │
                      ▼                    ▼                    ▼
               연결 허용           연결 거부 (401)      연결 거부 (401)
```

---

**최종 업데이트**: 2026년 1월 31일
